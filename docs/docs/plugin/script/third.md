## 第三方库导出（开发者自己实现）

### 背景

想要将 Unity 游戏导出到小游戏平台，那么 Unity 游戏中用到的一些插件，也需要进行处理，在小游戏平台上能够顺利运行。

这些插件分成几类：

1. 可以裁剪掉的插件。如其他第三方 SDK 等。这些插件在小游戏平台上，本来就用不到，建议裁剪掉。
2. 无法裁剪，但是有源码的插件。这种情况下，工具会将其直接转换为 js，导出到小游戏平台。在导出的 js 上二次开发，就可以使用。
3. 无法裁剪，同时也没有源码的插件，如只有 .dll 的插件。这种情况下，工具会为该插件生成桩代码，即该插件对外暴露的所有函数，函数实现为空实现。需要开发者自己填入实现。



### 插件目录配置

对于需要导出的插件，需要明确告诉工具，插件的根目录，插件源码的位置、插件.dll的位置（如果有的话）。

只有这样工具才能具体进行转化。具体配置方法见:[配置工程插件](./plugin-script.md)


### 桩代码与 js 实现

给定一个只有 dll 的 Unity 插件，工具会为它的对外函数生成桩代码。桩代码形如：

```cs
namespace DemoPlugin {
    [Bridge.FileName("plugin/DemoPlugin")]
    [Bridge.IgnoreCast]
    [Bridge.IgnoreGeneric]
    [Bridge.Namespace("DemoPlugin")]
    public struct Plugin {
        public void ADemoMethod() { throw new Exception("not impl")}
    }
}
```



其中，对外的接口函数，都只有函数定义，没有真正的实现。

这些桩代码，会在`导出工程插件`时，将被配置了`生成桩代码JavaScript模块`的插件生成并导出其桩实现的js代码 ，在小游戏开发者工具中进行二次开发。转出成 js 后，即可在 js 中，给函数填写实现。一般来说，在 js 中已经有某个库实现了这些功能的话，这里只需要填写胶水代码即可。



### 未来

后续，我们会针对这种情况，推出插件市场功能。针对 Unity 插件给出 js 插件，从而在小游戏平台上运行。该方案有待验证。